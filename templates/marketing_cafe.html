{% extends "base.html" %}
{% block title %}ë§ˆì¼€íŒ… - ì¹´í˜ ê´€ë¦¬{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>â˜• ì¹´í˜ ì‘ì—… ê´€ë¦¬</h1>
        <a href="/" class="btn btn-secondary">â† í™ˆìœ¼ë¡œ</a>
    </div>

    <!-- íƒ­ ë©”ë‰´ -->
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <a class="nav-link {{ 'active' if active_tab == 'status' else '' }}" href="/marketing/cafe?tab=status">ğŸ“Š ì „ì²´ í˜„í™©</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link {{ 'active' if active_tab == 'products' else '' }}" href="/marketing/cafe?tab=products">ğŸ“¦ ìƒí’ˆ ê´€ë¦¬</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link {{ 'active' if active_tab == 'accounts' else '' }}" href="/marketing/cafe?tab=accounts">ğŸ”‘ ê³„ì • ê´€ë¦¬</a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link {{ 'active' if active_tab == 'cafes' else '' }}" href="/marketing/cafe?tab=cafes">ğŸ“‹ ì¹´í˜ ê´€ë¦¬</a>
        </li>
    </ul>

    <!-- íƒ­ ì½˜í…ì¸  -->
    <div class="tab-content" id="myTabContent">
        <!-- ì „ì²´ í˜„í™© íƒ­ -->
        <div class="tab-pane fade {{ 'show active' if active_tab == 'status' else '' }}" id="status-tab-pane" role="tabpanel">
            <div class="p-5 text-center border-start border-end border-bottom">
                (TODO: ì „ì²´ í˜„í™© ëŒ€ì‹œë³´ë“œê°€ ì—¬ê¸°ì— í‘œì‹œë  ì˜ˆì •ì…ë‹ˆë‹¤.)
            </div>
        </div>
        
        <!-- ìƒí’ˆ ê´€ë¦¬ íƒ­ -->
        <div class="tab-pane fade {{ 'show active' if active_tab == 'products' else '' }}" id="products-tab-pane" role="tabpanel">
            <div class="p-3 border-start border-end border-bottom">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="mb-0">ë§ˆì¼€íŒ… ìƒí’ˆ ëª©ë¡</h3>
                    <a href="/marketing/product-selection" class="btn btn-success">â• ë§ˆì¼€íŒ… ìƒí’ˆ ì¶”ê°€</a>
                </div>

                <table class="table table-bordered table-hover text-center align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>ìƒí’ˆ ID</th>
                            <th>ì¸ë„¤ì¼</th>
                            <th>ìƒí’ˆëª…</th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for mp in marketing_products %}
                        <tr>
                            <td>{{ mp.product.product_code }}</td>
                            <td><img src="{{ mp.product.thumbnail }}" width="60" alt="ì¸ë„¤ì¼"></td>
                            <td class="text-start">{{ mp.product.name }}</td>
                            <td>
                                <a href="#" class="btn btn-sm btn-outline-primary">í‚¤ì›Œë“œ ê´€ë¦¬</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ê³„ì • ê´€ë¦¬ íƒ­ -->
        <div class="tab-pane fade {{ 'show active' if active_tab == 'accounts' else '' }}" id="accounts-tab-pane" role="tabpanel">
            <div class="p-3 border-start border-end border-bottom">
                <h3 class="mb-3">ì‹ ê·œ ê³„ì • ë“±ë¡</h3>
                <form action="/marketing/account/add" method="post" class="mb-4 p-3 border rounded bg-light">
                    <div class="row g-3 align-items-center">
                        <div class="col-md-3"><input type="text" name="account_id" class="form-control" placeholder="ë„¤ì´ë²„ ì•„ì´ë””" required></div>
                        <div class="col-md-3"><input type="password" name="account_pw" class="form-control" placeholder="ë¹„ë°€ë²ˆí˜¸" required></div>
                        <div class="col-md-4"><input type="text" name="ip_address" class="form-control" placeholder="IP ì£¼ì†Œ (ì„ íƒ ì‚¬í•­)"></div>
                        <div class="col-md-2"><button type="submit" class="btn btn-primary w-100">â• ì¶”ê°€</button></div>
                    </div>
                </form>

                <h3 class="mb-3">ë“±ë¡ëœ ê³„ì • ëª©ë¡</h3>
                <table class="table table-bordered table-hover text-center align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>#</th>
                            <th>í”Œë«í¼</th>
                            <th>ì•„ì´ë””</th>
                            <th>IP ì£¼ì†Œ</th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for acc in accounts %}
                        <tr>
                            <td>{{ acc.id }}</td>
                            <td>{{ acc.platform }}</td>
                            <td>{{ acc.account_id }}</td>
                            <td>{{ acc.ip_address or '-' }}</td>
                            <td>
                                <form action="/marketing/account/delete/{{ acc.id }}" method="post" onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                                    <button type="submit" class="btn btn-sm btn-outline-danger">ì‚­ì œ</button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ì¹´í˜ ê´€ë¦¬ íƒ­ -->
        <div class="tab-pane fade {{ 'show active' if active_tab == 'cafes' else '' }}" id="cafes-tab-pane" role="tabpanel">
            <div class="p-3 border-start border-end border-bottom">
                <h3 class="mb-3">ì‹ ê·œ íƒ€ê²Ÿ ì¹´í˜ ë“±ë¡</h3>
                <form action="/marketing/cafe/add" method="post" class="mb-4 p-3 border rounded bg-light">
                    <div class="row g-3 align-items-center">
                        <div class="col-md-5"><input type="text" name="name" class="form-control" placeholder="ì¹´í˜ ì´ë¦„" required></div>
                        <div class="col-md-5"><input type="url" name="url" class="form-control" placeholder="ì¹´í˜ URL" required></div>
                        <div class="col-md-2"><button type="submit" class="btn btn-primary w-100">â• ì¶”ê°€</button></div>
                    </div>
                </form>

                <h3 class="mb-3">ë“±ë¡ëœ ì¹´í˜ ëª©ë¡</h3>
                <table class="table table-bordered table-hover text-center align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>#</th>
                            <th>ì¹´í˜ ì´ë¦„</th>
                            <th>URL</th>
                            <th>í™œë™ ì •ì§€</th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for cafe in cafes %}
                        <tr>
                            <td>{{ cafe.id }}</td>
                            <td>{{ cafe.name }}</td>
                            <td class="text-start"><a href="{{ cafe.url }}" target="_blank">{{ cafe.url }}</a></td>
                            <td>{{ 'ì •ì§€' if cafe.is_suspended else 'í™œë™ì¤‘' }}</td>
                            <td>
                                <form action="/marketing/cafe/delete/{{ cafe.id }}" method="post" onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                                    <button type="submit" class="btn btn-sm btn-outline-danger">ì‚­ì œ</button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    // URL íŒŒë¼ë¯¸í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì˜¬ë°”ë¥¸ íƒ­ì„ í™œì„±í™”í•˜ëŠ” ê°„ë‹¨í•œ ìŠ¤í¬ë¦½íŠ¸
    document.addEventListener('DOMContentLoaded', function() {
        const params = new URLSearchParams(window.location.search);
        const tab = params.get('tab');
        
        // íƒ­ íŒŒë¼ë¯¸í„°ê°€ ì—†ìœ¼ë©´ 'status'ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì‚¬ìš©
        const activeTab = tab || 'status';

        const tabEl = document.querySelector(`a[href*="?tab=${activeTab}"]`);
        if(tabEl) {
            // ê¸°ì¡´ active í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.nav-link.active').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-pane.show.active').forEach(el => el.classList.remove('show', 'active'));

            // ìƒˆ íƒ­ í™œì„±í™”
            tabEl.classList.add('active');
            const paneId = activeTab + '-tab-pane';
            const paneEl = document.getElementById(paneId);
            if (paneEl) {
                paneEl.classList.add('show', 'active');
            }
        }
    });
</script>
{% endblock %}

