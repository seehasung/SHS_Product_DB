{% extends "base.html" %}
{% block title %}ì „ì²´ í˜„í™© - ì£¼ë¬¸ì¡°íšŒ{% endblock %}

{% block head %}
{{ super() }}
<style>
    .dashboard-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }
    
    /* í†µê³„ ì¹´ë“œ */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }
    
    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--stat-gradient);
        border-radius: 16px 16px 0 0;
    }
    
    .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
    }
    
    .stat-card.clickable {
        cursor: pointer;
    }
    
    .stat-card.clickable:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
    
    .stat-icon {
        width: 50px;
        height: 50px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        margin-bottom: 15px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .stat-value {
        font-size: 2rem;
        font-weight: 800;
        color: #2d3436;
        margin-bottom: 5px;
    }
    
    .stat-label {
        color: #636e72;
        font-size: 0.9rem;
        font-weight: 600;
    }
    
    /* í…Œì´ë¸” ì¹´ë“œ */
    .table-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        margin-bottom: 30px;
    }
    
    .table-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #e1e8ed;
    }
    
    .table-header h3 {
        font-size: 1.5rem;
        font-weight: 800;
        color: #2d3436;
        margin: 0;
    }
    
    /* ìƒíƒœ ê·¸ë¦¬ë“œ - í™”ë©´ ê½‰ ì±„ìš°ê¸° */
    .status-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        padding: 20px;
    }

    .status-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        padding: 20px;
        background: white;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid #e0e0e0;
    }

    .status-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        border-color: #4834d4;
    }

    .status-count {
        font-size: 1.5rem;
        font-weight: bold;
        color: #2d3436;
    }

    .status-badge.warning {
        background: #fff3cd;
        color: #856404;
        border: 2px solid #f39c12;
    }

    /* ë¹ ë¥¸ ê¸°ê°„ ì„ íƒ ë²„íŠ¼ */
    .quick-period-btn {
        padding: 8px 16px;
        border: 2px solid #e1e8ed;
        background: white;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .quick-period-btn:hover {
        border-color: #4A90E2;
        background: #f0f7ff;
        color: #4A90E2;
        transform: translateY(-2px);
    }

    .quick-period-btn:active {
        transform: translateY(0);
    }

    .quick-period-btn i {
        font-size: 0.9rem;
    }
    
    /* í…Œì´ë¸” */
    .order-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
    }
    
    .order-table thead th {
        background: linear-gradient(135deg, rgba(74, 144, 226, 0.1) 0%, rgba(91, 163, 245, 0.1) 100%);
        padding: 15px;
        text-align: left;
        font-weight: 700;
        color: #2d3436;
        font-size: 0.9rem;
        border-bottom: 2px solid #e1e8ed;
    }
    
    .order-table thead th:first-child {
        border-radius: 10px 0 0 0;
    }
    
    .order-table thead th:last-child {
        border-radius: 0 10px 0 0;
    }
    
    .order-table tbody tr {
        transition: all 0.2s;
        background: white;
    }
    
    .order-table tbody tr:hover {
        background: rgba(74, 144, 226, 0.05);
        transform: scale(1.01);
    }
    
    .order-table tbody td {
        padding: 15px;
        border-bottom: 1px solid #f1f3f5;
        color: #495057;
        font-size: 0.9rem;
    }
    
    /* ìƒíƒœ ë°°ì§€ */
    .status-badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        display: inline-block;
    }
    
    .status-badge.completed {
        background: #d4edda;
        color: #155724;
    }
    
    .status-badge.shipping {
        background: #cce5ff;
        color: #004085;
    }
    
    .status-badge.pending {
        background: #fff3cd;
        color: #856404;
    }
    
    .status-badge.cancelled {
        background: #f8d7da;
        color: #721c24;
    }
    
    /* ì•¡ì…˜ ë²„íŠ¼ */
    .btn-action {
        padding: 6px 12px;
        border: none;
        border-radius: 8px;
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        margin-right: 5px;
    }
    
    .btn-view {
        background: #4A90E2;
        color: white;
    }
    
    .btn-view:hover {
        background: #3a7bc8;
    }
    
    .btn-delete {
        background: #eb3349;
        color: white;
    }
    
    .btn-delete:hover {
        background: #d62839;
    }
    
    .no-data {
        text-align: center;
        padding: 60px 20px;
        color: #adb5bd;
    }
    
    .no-data i {
        font-size: 4rem;
        margin-bottom: 20px;
        opacity: 0.5;
    }

    /* í†µê´€ íƒ€ì„ë¼ì¸ ìŠ¤íƒ€ì¼ */
    .customs-timeline {
        position: relative;
        padding: 20px 0;
    }

    .timeline-item {
        display: flex;
        margin-bottom: 20px;
        position: relative;
    }

    .timeline-item:not(:last-child)::after {
        content: '';
        position: absolute;
        left: 15px;
        top: 35px;
        bottom: -20px;
        width: 2px;
        background: #dee2e6;
    }

    .timeline-marker {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        flex-shrink: 0;
        z-index: 1;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
    }

    .timeline-content {
        margin-left: 20px;
        flex-grow: 1;
        background: white;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .timeline-date {
        color: #667eea;
        font-size: 0.9em;
        font-weight: 600;
        margin-bottom: 5px;
    }

    .timeline-title {
        font-weight: bold;
        color: #2d3436;
        margin-bottom: 3px;
    }

    .timeline-location {
        color: #636e72;
        font-size: 0.9em;
    }

    .timeline-remark {
        color: #00b894;
        font-size: 0.85em;
        margin-top: 5px;
        font-style: italic;
    }

    .customs-info h4 {
        border-left: 4px solid #667eea;
        padding-left: 15px;
        margin-bottom: 20px;
        font-weight: 700;
        color: #2d3436;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- í˜ì´ì§€ í—¤ë” -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 style="font-weight: 800; color: #2d3436;">
            <i class="bi bi-speedometer2"></i> ì „ì²´ í˜„í™©
        </h1>
        <div>
            {% if is_admin %}
            <a href="/orders/mappings" class="btn btn-warning me-2">
                <i class="bi bi-diagram-3"></i> ë§¤í•‘ ê´€ë¦¬
            </a>
            {% endif %}
            <a href="/orders/upload" class="btn btn-primary me-2">
                <i class="bi bi-cloud-upload"></i> ë°ì´í„° ì—…ë¡œë“œ
            </a>
            <a href="/orders/search" class="btn btn-success">
                <i class="bi bi-search"></i> ì£¼ë¬¸ì¡°íšŒ
            </a>
        </div>
    </div>
    
    <!-- í†µê³„ ì¹´ë“œ (í´ë¦­ ê°€ëŠ¥) -->
    <div class="stats-grid">
        <!-- 1. ê°€ì†¡ì¥ ì‚¬ìš© ê±´ -->
        <div class="stat-card clickable" onclick="showOrdersByCondition('fake_tracking', 'ê°€ì†¡ì¥ ì‚¬ìš©')" 
             style="--stat-gradient: linear-gradient(90deg, #fd79a8 0%, #fdcb6e 100%);">
            <div class="stat-icon" style="background: linear-gradient(135deg, #fd79a8 0%, #fdcb6e 100%); color: white;">
                <i class="bi bi-receipt-cutoff"></i>
            </div>
            <div class="stat-value">{{ "{:,}".format(fake_tracking_count) }}</div>
            <div class="stat-label">ê°€ì†¡ì¥ ì‚¬ìš© ê±´</div>
        </div>
        
        <!-- 2. ë„¤ì´ë²„ ì†¡ì¥ íë¦„ -->
        <div class="stat-card" style="--stat-gradient: linear-gradient(90deg, #00b894 0%, #55efc4 100%);">
            <div class="stat-icon" style="background: linear-gradient(135deg, #00b894 0%, #55efc4 100%); color: white;">
                <i class="bi bi-truck"></i>
            </div>
            <div class="stat-value">{{ "{:,}".format(naver_delivery_count) }}</div>
            <div class="stat-label">ë„¤ì´ë²„ ì†¡ì¥ íë¦„</div>
        </div>
        
        <!-- 3. ê²½ë™ ì´ê´€ -->
        <div class="stat-card clickable" onclick="showOrdersByCondition('kyungdong', 'ê²½ë™ ì´ê´€')"
             style="--stat-gradient: linear-gradient(90deg, #6c5ce7 0%, #a29bfe 100%);">
            <div class="stat-icon" style="background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%); color: white;">
                <i class="bi bi-arrow-left-right"></i>
            </div>
            <div class="stat-value">{{ "{:,}".format(kyungdong_count) }}</div>
            <div class="stat-label">ê²½ë™ ì´ê´€</div>
        </div>
        
        <!-- 4. í†µê´€ ì ˆì°¨ ì´ìƒ -->
        <div class="stat-card clickable" onclick="showOrdersByCondition('customs_issue', 'í†µê´€ ì ˆì°¨ ì´ìƒ')"
             style="--stat-gradient: linear-gradient(90deg, #e17055 0%, #fab1a0 100%); position: relative;">
            <div class="stat-icon" style="background: linear-gradient(135deg, #e17055 0%, #fab1a0 100%); color: white;">
                <i class="bi bi-exclamation-triangle"></i>
            </div>
            <div class="stat-value" id="customsIssueCount">{{ "{:,}".format(customs_issue_count) }}</div>
            <div class="stat-label">í†µê´€ ì ˆì°¨ ì´ìƒ</div>
            <!-- ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ (ì ˆëŒ€ ìœ„ì¹˜) -->
            <button onclick="event.stopPropagation(); confirmCustomsCheck();" 
                    class="btn btn-sm" 
                    style="position: absolute;
                           top: 12px;
                           right: 12px;
                           padding: 0;
                           background: white; 
                           border: none; 
                           color: #e17055;
                           border-radius: 50%;
                           width: 30px;
                           height: 30px;
                           display: flex;
                           align-items: center;
                           justify-content: center;
                           transition: all 0.3s;
                           box-shadow: 0 2px 8px rgba(0,0,0,0.15);
                           font-size: 1.2rem;"
                    onmouseover="this.style.transform='rotate(180deg) scale(1.15)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.25)'"
                    onmouseout="this.style.transform='rotate(0deg) scale(1)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.15)'"
                    title="í†µê´€ ì ˆì°¨ ì¬ìˆ˜ì§‘">
                â†»
            </button>
        </div>
        
        <!-- 5. ì¥ê¸° ë¯¸ë°°ì†¡ -->
        <div class="stat-card clickable" onclick="showOrdersByCondition('long_undelivered', 'ì¥ê¸° ë¯¸ë°°ì†¡')"
             style="--stat-gradient: linear-gradient(90deg, #d63031 0%, #ff7675 100%);">
            <div class="stat-icon" style="background: linear-gradient(135deg, #d63031 0%, #ff7675 100%); color: white;">
                <i class="bi bi-clock-history"></i>
            </div>
            <div class="stat-value">{{ "{:,}".format(long_undelivered_count) }}</div>
            <div class="stat-label">ì¥ê¸° ë¯¸ë°°ì†¡ (2ì£¼+)</div>
        </div>
    </div>
    
    <!-- ìƒíƒœë³„ í˜„í™© (ê¸°ê°„ ì„¤ì • + í´ë¦­ ê°€ëŠ¥ ë²„íŠ¼) -->
    <div class="table-card">
        <div class="table-header" style="flex-direction: column; align-items: stretch; gap: 15px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3><i class="bi bi-bar-chart-fill"></i> ìƒíƒœë³„ í˜„í™© ({{ current_month }})</h3>
            </div>
            
            <!-- ë¹ ë¥¸ ê¸°ê°„ ì„ íƒ ë²„íŠ¼ -->
            <div style="display: flex; gap: 8px; flex-wrap: wrap; align-items: center;">
                <span style="font-weight: 600; color: #636e72; margin-right: 5px;">ë¹ ë¥¸ ì„ íƒ:</span>
                <button class="quick-period-btn" onclick="setQuickPeriod('7days')">
                    <i class="bi bi-calendar-week"></i> 7ì¼
                </button>
                <button class="quick-period-btn" onclick="setQuickPeriod('thisMonth')">
                    <i class="bi bi-calendar-month"></i> ì´ë²ˆë‹¬
                </button>
                <button class="quick-period-btn" onclick="setQuickPeriod('lastMonth')">
                    <i class="bi bi-calendar"></i> ì „ë‹¬
                </button>
                <button class="quick-period-btn" onclick="setQuickPeriod('3months')">
                    <i class="bi bi-calendar3"></i> 3ê°œì›”
                </button>
                <button class="quick-period-btn" onclick="setQuickPeriod('6months')">
                    <i class="bi bi-calendar-range"></i> 6ê°œì›”
                </button>
                
                <!-- ë‚ ì§œ ì§ì ‘ ì„ íƒ -->
                <div style="display: flex; gap: 8px; align-items: center; margin-left: auto;">
                    <input type="date" id="statusStartDate" class="form-control" style="width: 160px; flex-shrink: 0;">
                    <span style="color: #636e72;">~</span>
                    <input type="date" id="statusEndDate" class="form-control" style="width: 160px; flex-shrink: 0;">
                    <button class="btn btn-primary btn-sm" onclick="updateStatusPeriod()" style="white-space: nowrap;">
                        <i class="bi bi-search"></i> ì¡°íšŒ
                    </button>
                </div>
            </div>
        </div>
        
        <div class="status-grid" id="statusGrid">
            {% if status_stats %}
                {% for status, count in status_stats %}
                <div class="status-item" 
                    onclick="{% if status == 'ë¯¸ë¶„ë¥˜' %}showUnmappedModal(){% else %}showOrdersByStatus('{{ status }}'){% endif %}"
                    style="{% if status == 'ë¯¸ë¶„ë¥˜' %}border-color: #f39c12;{% endif %}">
                    <div class="status-badge 
                        {% if status == 'ë°°ì†¡ì¤‘' %}shipping
                        {% elif status == 'ë°°ì†¡ì™„ë£Œ' %}completed
                        {% elif status == 'ì·¨ì†Œ' %}cancelled
                        {% elif status == 'ë°˜í’ˆ' %}cancelled
                        {% elif status == 'êµí™˜' %}pending
                        {% elif status == 'ë¯¸ë¶„ë¥˜' %}warning
                        {% else %}pending{% endif %}">
                        {{ status }}
                        {% if status == 'ë¯¸ë¶„ë¥˜' %}<i class="bi bi-gear ms-1"></i>{% endif %}
                    </div>
                    <div class="status-count">{{ "{:,}".format(count) }}ê±´</div>
                </div>
                {% endfor %}
            {% else %}
                <p style="color: #636e72; text-align: center; padding: 20px;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</p>
            {% endif %}
        </div>
    </div>
    <!-- í†µê´€ ì¡°íšŒ ì„¹ì…˜ -->
    <div class="table-card">
        <div class="table-header">
            <h3><i class="bi bi-search"></i> í†µê´€ ì§„í–‰ì •ë³´ ì¡°íšŒ</h3>
        </div>
        
        <div class="alert alert-info">
            <strong>ğŸ’¡ ì¡°íšŒ ë°©ë²•:</strong>
            <ul class="mb-0">
                <li><strong>êµ­ì œíŠ¹ì†¡ (EMS, DHL ë“±)</strong>: ì†¡ì¥ë²ˆí˜¸ë§Œ ì…ë ¥</li>
                <li><strong>ì¼ë°˜ ìˆ˜ì…í™”ë¬¼</strong>: ë§ˆìŠ¤í„° B/L ì…ë ¥ (í•˜ìš°ìŠ¤ B/L ì„ íƒ)</li>
            </ul>
        </div>
        
        <form id="customsSearchForm" onsubmit="searchCustoms(event)">
            <!-- ì†¡ì¥ë²ˆí˜¸ ì…ë ¥ -->
            <div class="form-group mb-3">
                <label><i class="bi bi-upc-scan"></i> ì†¡ì¥ë²ˆí˜¸ (êµ­ì œíŠ¹ì†¡)</label>
                <input type="text" class="form-control" id="trackingNumberInput" 
                       placeholder="ì˜ˆ: EZ123456789KR">
            </div>
            
            <div class="text-center my-3">
                <strong>ë˜ëŠ”</strong>
            </div>
            
            <!-- B/L ë²ˆí˜¸ ì…ë ¥ -->
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label><i class="bi bi-box-seam"></i> ë§ˆìŠ¤í„° B/L (ì¼ë°˜í™”ë¬¼)</label>
                        <input type="text" class="form-control" id="masterBlInput" 
                               placeholder="ì˜ˆ: ABCD1234567">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label><i class="bi bi-boxes"></i> í•˜ìš°ìŠ¤ B/L (ì„ íƒ)</label>
                        <input type="text" class="form-control" id="houseBlInput" 
                               placeholder="ì„ íƒì‚¬í•­">
                    </div>
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary btn-lg" style="width: 100%; padding: 12px;">
                <i class="bi bi-search"></i> í†µê´€ ì¡°íšŒ
            </button>
        </form>
    </div>
    
    <!-- ì£¼ë¬¸ ëª©ë¡ í…Œì´ë¸” (ë™ì ) -->
    <div class="table-card">
        <div class="table-header">
            <h3 id="ordersTableTitle"><i class="bi bi-list-ul"></i> ì£¼ë¬¸ ëª©ë¡</h3>
            <div>
                <span id="ordersCount" style="color: #636e72;"></span>
            </div>
        </div>
        
        <div id="ordersTableContainer">
            <div class="no-data">
                <i class="bi bi-mouse"></i>
                <p style="font-size: 1.1rem; margin-top: 10px;">í†µê³„ ì¹´ë“œ ë˜ëŠ” ìƒíƒœë¥¼ í´ë¦­í•˜ì„¸ìš”</p>
                <p style="color: #636e72;">í•´ë‹¹ ì¡°ê±´ì˜ ì£¼ë¬¸ ëª©ë¡ì´ í‘œì‹œë©ë‹ˆë‹¤</p>
            </div>
        </div>
    </div>
</div>


<!-- ì£¼ë¬¸ ìƒì„¸ ëª¨ë‹¬ -->
<div class="modal fade" id="orderDetailModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="bi bi-file-text"></i> ì£¼ë¬¸ ìƒì„¸ ì •ë³´</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="orderDetailContent">
                <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">ë¡œë”© ì¤‘...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ë¯¸ë¶„ë¥˜ ìƒíƒœ ê´€ë¦¬ ëª¨ë‹¬ -->
<div class="modal fade" id="unmappedModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="bi bi-question-circle"></i> ë¯¸ë¶„ë¥˜ ìƒíƒœ ê´€ë¦¬</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted">ê° ìƒíƒœë¥¼ ì–´ëŠ ë¶„ë¥˜ë¡œ ë³´ë‚¼ì§€ ì„ íƒí•˜ì„¸ìš”.</p>
                <div id="unmappedStatusList">
                    <div class="text-center py-5">
                        <div class="spinner-border text-primary"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ë°°ì†¡ ì¡°íšŒ ëª¨ë‹¬ -->
<div class="modal fade" id="trackingModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-truck"></i> <span id="trackingTitle">ë°°ì†¡ ì¡°íšŒ</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="trackingContent">
                <div class="text-center py-5">
                    <div class="spinner-border text-primary"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- í†µê´€ ì¡°íšŒ ëª¨ë‹¬ -->
<div class="modal fade" id="customsModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <h5 class="modal-title">
                    <i class="bi bi-globe"></i> í†µê´€ ì§„í–‰ì •ë³´
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="customsContent">
                <div class="text-center py-5">
                    <div class="spinner-border text-primary"></div>
                    <p class="mt-3">í†µê´€ ì •ë³´ë¥¼ ì¡°íšŒ ì¤‘ì…ë‹ˆë‹¤...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-lg"></i> ë‹«ê¸°
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
<div id="loadingOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999; justify-content: center; align-items: center;">
    <div class="text-center">
        <div class="spinner-border text-light" style="width: 4rem; height: 4rem;"></div>
        <h5 class="text-light mt-3">í†µê´€ ì •ë³´ ì¡°íšŒ ì¤‘...</h5>
    </div>
</div>

<script>

    function cleanTrackingNumber(trackingNumber) {
        if (!trackingNumber) return '-';
        const cleaned = String(trackingNumber);
        if (cleaned.endsWith('.0')) {
            return cleaned.slice(0, -2);
        }
        return cleaned;
    }
    // ===== ë°°ì†¡ ì¡°íšŒ ë©”ì¸ í•¨ìˆ˜ =====
    async function viewTracking(orderId) {
        console.log('=== ë°°ì†¡ ì¡°íšŒ ì‹œì‘ ===');
        console.log('Order ID:', orderId);
        
        const modal = new bootstrap.Modal(document.getElementById('trackingModal'));
        modal.show();
        
        document.getElementById('trackingContent').innerHTML = `
            <div class="text-center py-5">
                <div class="spinner-border text-primary"></div>
                <p class="mt-3">ë°°ì†¡ ì •ë³´ë¥¼ ì¡°íšŒ ì¤‘ì…ë‹ˆë‹¤...</p>
            </div>
        `;
        
        try {
            const response = await fetch(`/orders/api/tracking/${orderId}`);
            const data = await response.json();
            
            console.log('API ì‘ë‹µ:', data);
            
            if (!data.success) {
                document.getElementById('trackingContent').innerHTML = `
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle"></i> ${data.message || 'ë°°ì†¡ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'}
                    </div>
                `;
                return;
            }
            
            document.getElementById('trackingTitle').textContent = 
                `ë°°ì†¡ ì¡°íšŒ - ${data.courier} (${data.tracking_number})`;
            
            console.log('íƒë°°ì‚¬:', data.courier);
            
            // íƒë°°ì‚¬ë³„ ë Œë”ë§
            if (data.courier === 'CJëŒ€í•œí†µìš´') {
                console.log('CJ ë Œë”ë§ ì‹œì‘');
                renderCJTracking(data);
            } else if (data.courier === 'ê²½ë™íƒë°°') {
                console.log('ê²½ë™ ë Œë”ë§ ì‹œì‘');
                renderKDTracking(data);
            } else {
                console.log('ë²”ìš© ë Œë”ë§ ì‹œì‘');
                renderGenericTracking(data);
            }
            
        } catch (error) {
            console.error('ë°°ì†¡ ì¡°íšŒ ì˜¤ë¥˜:', error);
            document.getElementById('trackingContent').innerHTML = `
                <div class="alert alert-danger">
                    <i class="bi bi-exclamation-triangle"></i> ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}
                </div>
            `;
        }
    }

    // ===== CJëŒ€í•œí†µìš´ ë Œë”ë§ í•¨ìˆ˜ =====
    function renderCJTracking(data) {
        console.log('=== CJ ë Œë”ë§ ì‹œì‘ ===');
        
        try {
            const info = data.basic_info || {};
            const order = data.order_info || {};
            const details = data.details || [];
            
            let html = `
                <div class="container-fluid">
                    <!-- ì£¼ë¬¸ ì •ë³´ -->
                    <div class="card mb-3">
                        <div class="card-header bg-primary text-white">
                            <h6 class="mb-0"><i class="bi bi-box"></i> ì£¼ë¬¸ ì •ë³´</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4"><strong>ì£¼ë¬¸ë²ˆí˜¸:</strong> ${order.order_number || '-'}</div>
                                <div class="col-md-4"><strong>êµ¬ë§¤ì:</strong> ${order.buyer_name || '-'}</div>
                                <div class="col-md-4"><strong>ìˆ˜ë ¹ì:</strong> ${order.recipient_name || '-'}</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ê¸°ë³¸ ì •ë³´ -->
                    <div class="card mb-3">
                        <div class="card-header bg-success text-white">
                            <h6 class="mb-0"><i class="bi bi-info-circle"></i> ê¸°ë³¸ ì •ë³´</h6>
                        </div>
                        <div class="card-body">
                            <table class="table table-bordered mb-0">
                                <tr>
                                    <th width="20%" class="table-light">ìš´ì†¡ì¥ë²ˆí˜¸</th>
                                    <td colspan="3">${data.tracking_number}</td>
                                </tr>
                                <tr>
                                    <th class="table-light">ë³´ë‚´ëŠ” ë¶„</th>
                                    <td>${info.sender_name || '-'}</td>
                                    <th width="20%" class="table-light">ë°›ëŠ” ë¶„</th>
                                    <td>${info.receiver_name || '-'}</td>
                                </tr>
                                <tr>
                                    <th class="table-light">ë³´ë‚´ëŠ” ê³³</th>
                                    <td colspan="3">${info.sender_address || '-'}</td>
                                </tr>
                                <tr>
                                    <th class="table-light">ë°›ëŠ” ê³³</th>
                                    <td colspan="3">${info.receiver_address || '-'}</td>
                                </tr>
                                <tr>
                                    <th class="table-light">ìƒí’ˆëª…</th>
                                    <td>${info.product_name || '-'}</td>
                                    <th class="table-light">ìˆ˜ëŸ‰</th>
                                    <td>${info.quantity || '-'}</td>
                                </tr>
            `;
            
            // ì‹¤ì œ ìˆ˜ë ¹ì¸ ì •ë³´ê°€ ìˆìœ¼ë©´ í‘œì‹œ
            if (info.receiver && info.receiver_relation) {
                html += `
                                <tr>
                                    <th class="table-light">ì‹¤ì œ ìˆ˜ë ¹ì¸</th>
                                    <td colspan="3">${info.receiver} (${info.receiver_relation})</td>
                                </tr>
                `;
            }
            
            html += `
                            </table>
                        </div>
                    </div>
                    
                    <!-- ë°°ì†¡ ìƒì„¸ ì •ë³´ -->
                    <div class="card">
                        <div class="card-header bg-info text-white">
                            <h6 class="mb-0"><i class="bi bi-truck"></i> ë°°ì†¡ ìƒì„¸ ë‚´ì—­</h6>
                        </div>
                        <div class="card-body">
            `;
            
            if (details.length === 0) {
                html += `
                            <div class="alert alert-info mb-0">
                                <i class="bi bi-info-circle"></i> ì•„ì§ ë°°ì†¡ ì´ë ¥ì´ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
                            </div>
                `;
            } else {
                html += `
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th width="10%">ë‚ ì§œ</th>
                                            <th width="10%">ì‹œê°„</th>
                                            <th width="15%">ì²˜ë¦¬ì ì†Œ</th>
                                            <th width="12%">ì—°ë½ì²˜</th>
                                            <th width="13%">ìƒíƒœ</th>
                                            <th>ìƒì„¸ë‚´ìš©</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                `;
                
                details.forEach(detail => {
                    let badgeClass = 'bg-primary';
                    if (detail.status && detail.status.includes('ì™„ë£Œ')) {
                        badgeClass = 'bg-success';
                    } else if (detail.status && detail.status.includes('ì¶œë°œ')) {
                        badgeClass = 'bg-info';
                    } else if (detail.status && detail.status.includes('ì§‘í™”')) {
                        badgeClass = 'bg-secondary';
                    }
                    
                    html += `
                                        <tr>
                                            <td>${detail.date || '-'}</td>
                                            <td>${detail.time || '-'}</td>
                                            <td>${detail.location || '-'}</td>
                                            <td><small>${detail.phone || '-'}</small></td>
                                            <td><span class="badge ${badgeClass}">${detail.status || '-'}</span></td>
                                            <td>
                                                ${detail.detail || '-'}
                                                ${detail.partner ? `<br><small class="text-muted">â†’ ${detail.partner}</small>` : ''}
                                            </td>
                                        </tr>
                    `;
                });
                
                html += `
                                    </tbody>
                                </table>
                            </div>
                `;
            }
            
            html += `
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('trackingContent').innerHTML = html;
            console.log('=== CJ ë Œë”ë§ ì™„ë£Œ ===');
            
        } catch (error) {
            console.error('CJ ë Œë”ë§ ì˜¤ë¥˜:', error);
            throw error;
        }
    }

    // ===== ê²½ë™íƒë°° ë Œë”ë§ í•¨ìˆ˜ =====
    function renderKDTracking(data) {
        console.log('=== ê²½ë™íƒë°° ë Œë”ë§ ì‹œì‘ ===');
        
        try {
            const info = data.basic_info || {};
            const order = data.order_info || {};
            const details = data.details || [];
            
            let html = `
                <div class="container-fluid">
                    <!-- ì£¼ë¬¸ ì •ë³´ -->
                    <div class="card mb-3">
                        <div class="card-header bg-primary text-white">
                            <h6 class="mb-0"><i class="bi bi-box"></i> ì£¼ë¬¸ ì •ë³´</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4"><strong>ì£¼ë¬¸ë²ˆí˜¸:</strong> ${order.order_number || '-'}</div>
                                <div class="col-md-4"><strong>êµ¬ë§¤ì:</strong> ${order.buyer_name || '-'}</div>
                                <div class="col-md-4"><strong>ìˆ˜ë ¹ì:</strong> ${order.recipient_name || '-'}</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ê¸°ë³¸ ì •ë³´ -->
                    <div class="card mb-3">
                        <div class="card-header bg-success text-white">
                            <h6 class="mb-0"><i class="bi bi-info-circle"></i> ê¸°ë³¸ ì •ë³´</h6>
                        </div>
                        <div class="card-body">
                            <table class="table table-bordered mb-0">
                                <tr>
                                    <th width="20%" class="table-light">ìš´ì†¡ì¥ë²ˆí˜¸</th>
                                    <td colspan="3">${data.tracking_number}</td>
                                </tr>
                                <tr>
                                    <th class="table-light">ë°œì†¡ì§€ì </th>
                                    <td>${info.send_branch || '-'}</td>
                                    <th width="20%" class="table-light">ë„ì°©ì§€ì </th>
                                    <td>${info.arrival_branch || '-'}</td>
                                </tr>
                                <tr>
                                    <th class="table-light">ë³´ë‚´ëŠ” ë¶„</th>
                                    <td>${info.sender_name || '-'}</td>
                                    <th class="table-light">ë°›ëŠ” ë¶„</th>
                                    <td>${info.receiver_name || '-'}</td>
                                </tr>
                                <tr>
                                    <th class="table-light">ìƒí’ˆëª…</th>
                                    <td>${info.product_name || '-'}</td>
                                    <th class="table-light">ìˆ˜ëŸ‰</th>
                                    <td>${info.quantity || '-'}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    
                    <!-- ë°°ì†¡ ìƒì„¸ ì •ë³´ -->
                    <div class="card">
                        <div class="card-header bg-info text-white">
                            <h6 class="mb-0"><i class="bi bi-truck"></i> ë°°ì†¡ ìƒì„¸ ë‚´ì—­</h6>
                        </div>
                        <div class="card-body">
            `;
            
            if (details.length === 0) {
                html += `
                            <div class="alert alert-info mb-0">
                                <i class="bi bi-info-circle"></i> ì•„ì§ ë°°ì†¡ ì´ë ¥ì´ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
                            </div>
                `;
            } else {
                html += `
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th width="12%">ë‚ ì§œ</th>
                                            <th width="10%">ì‹œê°„</th>
                                            <th width="25%">ìœ„ì¹˜</th>
                                            <th width="18%">ì—°ë½ì²˜</th>
                                            <th>ìƒíƒœ</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                `;
                
                details.forEach(detail => {
                    let badgeClass = 'bg-primary';
                    if (detail.status && detail.status.includes('í™•ì¸')) {
                        badgeClass = 'bg-success';
                    } else if (detail.status && detail.status.includes('ë„ì°©')) {
                        badgeClass = 'bg-info';
                    } else if (detail.status && detail.status.includes('ë°œì†¡')) {
                        badgeClass = 'bg-warning';
                    }
                    
                    html += `
                                        <tr>
                                            <td>${detail.date || '-'}</td>
                                            <td>${detail.time || '-'}</td>
                                            <td>${detail.location || '-'}</td>
                                            <td><small>${detail.phone || '-'}</small></td>
                                            <td><span class="badge ${badgeClass}">${detail.status || '-'}</span></td>
                                        </tr>
                    `;
                });
                
                html += `
                                    </tbody>
                                </table>
                            </div>
                `;
            }
            
            html += `
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('trackingContent').innerHTML = html;
            console.log('=== ê²½ë™íƒë°° ë Œë”ë§ ì™„ë£Œ ===');
            
        } catch (error) {
            console.error('ê²½ë™íƒë°° ë Œë”ë§ ì˜¤ë¥˜:', error);
            throw error;
        }
    }

    // ===== ë²”ìš© ë Œë”ë§ í•¨ìˆ˜ (ìš°ì²´êµ­/ë¡œì  /í•œì§„/ë¡¯ë°) =====
    function renderGenericTracking(data) {
        console.log('=== ë²”ìš© ë Œë”ë§ ì‹œì‘ ===');
        
        try {
            const info = data.basic_info || {};
            const order = data.order_info || {};
            const details = data.details || [];
            
            let html = `
                <div class="container-fluid">
                    <!-- ì£¼ë¬¸ ì •ë³´ -->
                    <div class="card mb-3">
                        <div class="card-header bg-primary text-white">
                            <h6 class="mb-0"><i class="bi bi-box"></i> ì£¼ë¬¸ ì •ë³´</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4"><strong>ì£¼ë¬¸ë²ˆí˜¸:</strong> ${order.order_number || '-'}</div>
                                <div class="col-md-4"><strong>êµ¬ë§¤ì:</strong> ${order.buyer_name || '-'}</div>
                                <div class="col-md-4"><strong>ìˆ˜ë ¹ì:</strong> ${order.recipient_name || '-'}</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ê¸°ë³¸ ì •ë³´ -->
                    <div class="card mb-3">
                        <div class="card-header bg-success text-white">
                            <h6 class="mb-0"><i class="bi bi-info-circle"></i> ê¸°ë³¸ ì •ë³´</h6>
                        </div>
                        <div class="card-body">
                            <table class="table table-bordered mb-0">
                                <tr>
                                    <th width="20%" class="table-light">ìš´ì†¡ì¥ë²ˆí˜¸</th>
                                    <td colspan="3">${data.tracking_number}</td>
                                </tr>
                                <tr>
                                    <th class="table-light">ë³´ë‚´ëŠ” ë¶„</th>
                                    <td>${info.sender_name || '-'}</td>
                                    <th width="20%" class="table-light">ë°›ëŠ” ë¶„</th>
                                    <td>${info.receiver_name || '-'}</td>
                                </tr>
                                <tr>
                                    <th class="table-light">ìƒí’ˆëª…</th>
                                    <td>${info.product_name || '-'}</td>
                                    <th class="table-light">ìˆ˜ëŸ‰</th>
                                    <td>${info.quantity || '-'}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    
                    <!-- ë°°ì†¡ ìƒì„¸ ì •ë³´ -->
                    <div class="card">
                        <div class="card-header bg-info text-white">
                            <h6 class="mb-0"><i class="bi bi-truck"></i> ë°°ì†¡ ìƒì„¸ ë‚´ì—­</h6>
                        </div>
                        <div class="card-body">
            `;
            
            if (details.length === 0) {
                html += `
                            <div class="alert alert-info mb-0">
                                <i class="bi bi-info-circle"></i> ì•„ì§ ë°°ì†¡ ì´ë ¥ì´ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
                            </div>
                `;
            } else {
                html += `
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th width="12%">ë‚ ì§œ</th>
                                            <th width="10%">ì‹œê°„</th>
                                            <th width="25%">ì²˜ë¦¬ì ì†Œ</th>
                                            <th>ì²˜ë¦¬í˜„í™©</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                `;
                
                details.forEach(detail => {
                    let badgeClass = 'bg-primary';
                    if (detail.status && (detail.status.includes('ì™„ë£Œ') || detail.status.includes('ë°°ë‹¬'))) {
                        badgeClass = 'bg-success';
                    } else if (detail.status && detail.status.includes('ì¶œë°œ')) {
                        badgeClass = 'bg-info';
                    }
                    
                    html += `
                                        <tr>
                                            <td>${detail.date || '-'}</td>
                                            <td>${detail.time || '-'}</td>
                                            <td>${detail.location || '-'}</td>
                                            <td><span class="badge ${badgeClass}">${detail.status || '-'}</span></td>
                                        </tr>
                    `;
                });
                
                html += `
                                    </tbody>
                                </table>
                            </div>
                `;
            }
            
            html += `
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('trackingContent').innerHTML = html;
            console.log('=== ë²”ìš© ë Œë”ë§ ì™„ë£Œ ===');
            
        } catch (error) {
            console.error('ë²”ìš© ë Œë”ë§ ì˜¤ë¥˜:', error);
            throw error;
        }
    }

    // ===== ì£¼ë¬¸ ìƒì„¸ë³´ê¸° =====
    async function viewOrder(orderId) {
        const modal = new bootstrap.Modal(document.getElementById('orderDetailModal'));
        modal.show();
        
        document.getElementById('orderDetailContent').innerHTML = `
            <div class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">ë¡œë”© ì¤‘...</span>
                </div>
            </div>
        `;
        
        try {
            const response = await fetch(`/orders/api/${orderId}/detail`);
            const order = await response.json();
            
            document.getElementById('orderDetailContent').innerHTML = `
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-bold">ì£¼ë¬¸ë²ˆí˜¸</label>
                        <input type="text" class="form-control" value="${order.order_number || '-'}" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-bold">ì£¼ë¬¸ìƒíƒœ</label>
                        <input type="text" class="form-control" value="${order.order_status || '-'}" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-bold">ì£¼ë¬¸ì¼ì</label>
                        <input type="text" class="form-control" value="${order.order_date || '-'}" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-bold">êµ¬ë§¤ì</label>
                        <input type="text" class="form-control" value="${order.buyer_name || '-'}" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-bold">ìˆ˜ë ¹ì</label>
                        <input type="text" class="form-control" value="${order.recipient_name || '-'}" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-bold">ì—°ë½ì²˜</label>
                        <input type="text" class="form-control" value="${order.contact_number || '-'}" readonly>
                    </div>
                    <div class="col-12 mb-3">
                        <label class="form-label fw-bold">ì œí’ˆëª…</label>
                        <input type="text" class="form-control" value="${order.product_name || '-'}" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-bold">ì˜µì…˜</label>
                        <input type="text" class="form-control" value="${order.product_option || '-'}" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-bold">ìˆ˜ëŸ‰</label>
                        <input type="text" class="form-control" value="${order.quantity || '-'}" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-bold">ì†¡ì¥ë²ˆí˜¸</label>
                        <input type="text" class="form-control" value="${order.tracking_number || '-'}" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-bold">í†µê´€ë²ˆí˜¸</label>
                        <input type="text" class="form-control" value="${order.customs_number || '-'}" readonly>
                    </div>
                    <div class="col-12 mb-3">
                        <label class="form-label fw-bold">ì£¼ì†Œ</label>
                        <textarea class="form-control" rows="2" readonly>${order.address || '-'}</textarea>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-bold">ê²°ì œê¸ˆì•¡</label>
                        <input type="text" class="form-control" value="${order.payment_amount || '-'}ì›" readonly>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-bold">í™˜ìœ¨</label>
                        <input type="text" class="form-control" value="${order.exchange_rate || '-'}" readonly>
                    </div>
                </div>
            `;
        } catch (error) {
            document.getElementById('orderDetailContent').innerHTML = `
                <div class="alert alert-danger">
                    <i class="bi bi-exclamation-triangle"></i> ì£¼ë¬¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.
                </div>
            `;
        }
    }

    // ===== ì£¼ë¬¸ ì‚­ì œ =====
    async function deleteOrder(orderId) {
        if (!confirm('ì •ë§ë¡œ ì´ ì£¼ë¬¸ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        
        try {
            const response = await fetch(`/orders/api/${orderId}/delete`, {
                method: 'POST'
            });
            
            const result = await response.json();
            
            if (result.success) {
                alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.'); 
                location.reload();
            } else {
                alert('ì‚­ì œ ì‹¤íŒ¨: ' + result.message);
            }
        } catch (error) {
            alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }

    // ===== ì¡°ê±´ë³„ ì£¼ë¬¸ ëª©ë¡ í‘œì‹œ =====
    // ===== í† ìŠ¤íŠ¸ ì•Œë¦¼ í•¨ìˆ˜ =====
    function showToast(message, type = 'info', autoClose = false) {
        // í† ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ ìƒì„± (ì—†ìœ¼ë©´)
        let container = document.getElementById('toastContainer');
        if (!container) {
            container = document.createElement('div');
            container.id = 'toastContainer';
            container.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 9999;';
            document.body.appendChild(container);
        }
        
        // í† ìŠ¤íŠ¸ ìƒì„±
        const toast = document.createElement('div');
        toast.className = `alert alert-${type} fade show`;
        toast.style.cssText = 'min-width: 320px; box-shadow: 0 6px 20px rgba(0,0,0,0.2); margin-bottom: 10px; animation: slideIn 0.3s ease-out;';
        toast.innerHTML = `
            <div class="d-flex align-items-center">
                <div class="spinner-border spinner-border-sm me-3" role="status" ${type !== 'info' ? 'style="display:none;"' : ''}></div>
                <div style="flex: 1;">${message}</div>
            </div>
        `;
        
        container.appendChild(toast);
        
        // autoCloseê°€ trueì´ê³  infoê°€ ì•„ë‹ˆë©´ ìë™ ì‚­ì œ
        if (autoClose && type !== 'info') {
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        return toast;
    }

    // ===== í†µê´€ ì ˆì°¨ ì´ìƒ í™•ì¸ íŒì—… =====
    function confirmCustomsCheck() {
        if (confirm('í†µê´€ ì ˆì°¨ë¥¼ ì¬ìˆ˜ì§‘ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì£¼ì˜: ëª¨ë“  ì¡°ê±´ í•´ë‹¹ ì£¼ë¬¸ì„ ì²´í¬í•˜ë¯€ë¡œ\nìˆ˜ ë¶„ì´ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.')) {
            refreshCustomsIssueCheck();
        }
    }

    // ===== í†µê´€ ì ˆì°¨ ì´ìƒ ìˆ˜ë™ ì²´í¬ =====
    async function refreshCustomsIssueCheck() {
        const countElement = document.getElementById('customsIssueCount');
        const originalText = countElement.textContent;
        
        // â­ ì§„í–‰ ìƒí™© í† ìŠ¤íŠ¸ (ì™„ë£Œë  ë•Œê¹Œì§€ ê³„ì† í‘œì‹œ)
        const progressToast = showToast('ğŸ” í†µê´€ ì ˆì°¨ ì²´í¬ ì¤‘...<br><small>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš” (ìˆ˜ ë¶„ ì†Œìš”)</small>', 'info', false);
        
        // ë¡œë”© í‘œì‹œ
        countElement.innerHTML = '<div class="spinner-border spinner-border-sm"></div>';
        
        try {
            const response = await fetch('/orders/api/check-customs-issues', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            
            const result = await response.json();
            
            // â­ ì§„í–‰ í† ìŠ¤íŠ¸ ì œê±° (ì™„ë£Œë¨)
            progressToast.classList.remove('show');
            setTimeout(() => progressToast.remove(), 300);
            
            if (result.success) {
                // ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
                countElement.textContent = result.count.toLocaleString();
                
                // ì„±ê³µ í† ìŠ¤íŠ¸ (3ì´ˆ í›„ ìë™ ì‚­ì œ)
                const successToast = showToast(`âœ… ì²´í¬ ì™„ë£Œ! ë°œê²¬: ${result.count}ê±´`, 'success', true);
                
                // 3ì´ˆ í›„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                setTimeout(() => window.location.reload(), 3000);
            } else {
                countElement.textContent = originalText;
                
                // ì‹¤íŒ¨ í† ìŠ¤íŠ¸ (5ì´ˆ í›„ ìë™ ì‚­ì œ)
                showToast(`âŒ ì²´í¬ ì‹¤íŒ¨: ${result.message}`, 'danger', true);
            }
        } catch (error) {
            // ì§„í–‰ í† ìŠ¤íŠ¸ ì œê±°
            progressToast.classList.remove('show');
            setTimeout(() => progressToast.remove(), 300);
            
            countElement.textContent = originalText;
            
            console.error('í†µê´€ ì ˆì°¨ ì´ìƒ ì²´í¬ ì˜¤ë¥˜:', error);
            
            // ì—ëŸ¬ í† ìŠ¤íŠ¸ (5ì´ˆ í›„ ìë™ ì‚­ì œ)
            showToast('âŒ ì²´í¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'danger', true);
        }
    }

    async function showOrdersByCondition(condition, title) {
        document.getElementById('ordersTableTitle').innerHTML = `<i class="bi bi-filter"></i> ${title} ì£¼ë¬¸ ëª©ë¡`;
        document.getElementById('ordersTableContainer').innerHTML = '<div style="text-align: center; padding: 40px;"><div class="spinner-border text-primary"></div></div>';
        
        try {
            const response = await fetch(`/orders/api/orders/by-condition?condition=${condition}`);
            const data = await response.json();
            
            displayOrders(data.orders, title);
        } catch (error) {
            document.getElementById('ordersTableContainer').innerHTML = `
                <div class="alert alert-danger">
                    <i class="bi bi-exclamation-triangle"></i> ì£¼ë¬¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.
                </div>
            `;
        }
    }

    // ===== ìƒíƒœë³„ ì£¼ë¬¸ ëª©ë¡ í‘œì‹œ =====
    async function showOrdersByStatus(status) {
        const startDate = document.getElementById('statusStartDate').value;
        const endDate = document.getElementById('statusEndDate').value;
        
        document.getElementById('ordersTableTitle').innerHTML = `<i class="bi bi-filter"></i> ${status} ì£¼ë¬¸ ëª©ë¡`;
        document.getElementById('ordersTableContainer').innerHTML = '<div style="text-align: center; padding: 40px;"><div class="spinner-border text-primary"></div></div>';
        
        try {
            const response = await fetch(`/orders/api/orders/by-status?status=${encodeURIComponent(status)}&start_date=${startDate}&end_date=${endDate}`);
            const data = await response.json();
            
            displayOrders(data.orders, status);
        } catch (error) {
            document.getElementById('ordersTableContainer').innerHTML = `
                <div class="alert alert-danger">
                    <i class="bi bi-exclamation-triangle"></i> ì£¼ë¬¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.
                </div>
            `;
        }
    }

    // ===== ì£¼ë¬¸ ëª©ë¡ í‘œì‹œ =====
    function displayOrders(orders, title) {
        document.getElementById('ordersCount').textContent = `ì´ ${orders.length}ê±´`;
        
        if (orders.length === 0) {
            document.getElementById('ordersTableContainer').innerHTML = `
                <div class="no-data">
                    <i class="bi bi-inbox"></i>
                    <p style="font-size: 1.1rem; margin-top: 10px;">ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤</p>
                </div>
            `;
            return;
        }
        
        let html = `
            <div style="overflow-x: auto;">
                <table class="order-table">
                    <thead>
                        <tr>
                            <th>ì£¼ë¬¸ë²ˆí˜¸</th>
                            <th>íŒë§¤ì²˜</th>
                            <th>ì£¼ë¬¸ìƒíƒœ</th>
                            <th>íƒë°°ì‚¬</th>
                            <th>ì†¡ì¥ë²ˆí˜¸</th>
                            <th>ì£¼ë¬¸ì¼ì</th>
                            <th>êµ¬ë§¤ì</th>
                            <th>ìˆ˜ë ¹ì</th>
                            <th>ì œí’ˆëª…</th>
                            <th>ê²°ì œê¸ˆì•¡</th>
                            <th>ì•¡ì…˜</th>
                        </tr>
                    </thead>
                    <tbody>
        `;
        
        orders.forEach(order => {
            let statusClass = 'pending';
            if (order.order_status.includes('ì™„ë£Œ') || order.order_status.includes('ë°°ì†¡')) {
                statusClass = 'completed';
            } else if (order.order_status.includes('ì·¨ì†Œ') || order.order_status.includes('ë°˜í’ˆ')) {
                statusClass = 'cancelled';
            } else if (order.order_status.includes('ëŒ€ê¸°') || order.order_status.includes('ì¤€ë¹„')) {
                statusClass = 'pending';
            } else {
                statusClass = 'shipping';
            }
            
            let formattedAmount = '-';
            if (order.payment_amount) {
                let amount = order.payment_amount.toString().replace(/[^0-9]/g, '');
                if (amount) {
                    formattedAmount = parseInt(amount).toLocaleString('ko-KR');
                }
            }
            
            let salesChannel = order.sales_channel || '-';
            if (salesChannel.length > 20) {
                salesChannel = salesChannel.substring(0, 20) + '...';
            }
            
            let courierCompany = order.courier_company || '-';
            let trackingNumber = order.tracking_number || '-';
            
            html += `
                <tr>
                    <td><strong>${order.order_number}</strong></td>
                    <td>${salesChannel}</td>
                    <td><span class="status-badge ${statusClass}">${order.order_status}</span></td>
                    <td>${courierCompany}</td>
                    <td>${cleanTrackingNumber(order.tracking_number)}</td>
                    <td>${order.order_date}</td>
                    <td>${order.buyer_name || '-'}</td>
                    <td>${order.recipient_name || '-'}</td>
                    <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                        ${order.product_name || '-'}
                    </td>
                    <td><strong>${formattedAmount}</strong></td>
                    <td>
                        <button class="btn-action btn-view" onclick="viewOrder(${order.id})">
                            <i class="bi bi-eye"></i> ìƒì„¸
                        </button>
                        <button class="btn-action btn-view" onclick="viewTracking(${order.id})" style="background: #00b894;">
                            <i class="bi bi-truck"></i> ë°°ì†¡
                        </button>
                        <button class="btn-action btn-view" onclick="viewCustoms(${order.id})" style="background: #667eea;">
                            <i class="bi bi-globe"></i> í†µê´€
                        </button>
                    </td>
                </tr>
            `;
        });
        
        html += `
                    </tbody>
                </table>
            </div>
        `;
        
        document.getElementById('ordersTableContainer').innerHTML = html;
    }

    // ===== ê¸°ê°„ ì—…ë°ì´íŠ¸ =====
    async function updateStatusPeriod() {
        const startDate = document.getElementById('statusStartDate').value;
        const endDate = document.getElementById('statusEndDate').value;
        
        if (!startDate || !endDate) {
            alert('ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
            return;
        }
        
        window.location.href = `/orders/dashboard?start_date=${startDate}&end_date=${endDate}`;
    }

    // ===== ë¹ ë¥¸ ê¸°ê°„ ì„ íƒ =====
    function setQuickPeriod(period) {
        const today = new Date();
        let startDate, endDate;
        
        endDate = today;
        
        switch(period) {
            case '7days':
                startDate = new Date(today);
                startDate.setDate(today.getDate() - 6);
                break;
            case 'thisMonth':
                startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                break;
            case 'lastMonth':
                startDate = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                endDate = new Date(today.getFullYear(), today.getMonth(), 0);
                break;
            case '3months':
                startDate = new Date(today);
                startDate.setMonth(today.getMonth() - 3);
                break;
            case '6months':
                startDate = new Date(today);
                startDate.setMonth(today.getMonth() - 6);
                break;
        }
        
        const formatDate = (date) => {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        };
        
        document.getElementById('statusStartDate').value = formatDate(startDate);
        document.getElementById('statusEndDate').value = formatDate(endDate);
        
        updateStatusPeriod();
    }

    // ===== ë¯¸ë¶„ë¥˜ ëª¨ë‹¬ í‘œì‹œ =====
    async function showUnmappedModal() {
        const modal = new bootstrap.Modal(document.getElementById('unmappedModal'));
        modal.show();
        
        try {
            const response = await fetch('/orders/api/unmapped-statuses');
            const data = await response.json();
            
            if (data.unmapped_statuses.length === 0) {
                document.getElementById('unmappedStatusList').innerHTML = `
                    <div class="alert alert-success">
                        <i class="bi bi-check-circle"></i> ëª¨ë“  ìƒíƒœê°€ ë§¤í•‘ë˜ì—ˆìŠµë‹ˆë‹¤!
                    </div>
                `;
                return;
            }
            
            let html = '<div class="list-group">';
            
            data.unmapped_statuses.forEach(item => {
                html += `
                    <div class="list-group-item mb-3" style="border-left: 4px solid #f39c12;">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div>
                                <strong style="font-size: 1.1rem;">${item.original_status}</strong>
                                <span class="badge bg-warning text-dark ms-2">${item.count}ê±´</span>
                            </div>
                        </div>
                        <div class="btn-group btn-group-sm w-100" role="group">
                            <button class="btn btn-outline-primary" onclick="saveMapping('${item.original_status}', 'ë°°ì†¡ì¤‘')">
                                <i class="bi bi-truck"></i> ë°°ì†¡ì¤‘
                            </button>
                            <button class="btn btn-outline-success" onclick="saveMapping('${item.original_status}', 'ë°°ì†¡ì™„ë£Œ')">
                                <i class="bi bi-check-circle"></i> ë°°ì†¡ì™„ë£Œ
                            </button>
                            <button class="btn btn-outline-warning" onclick="saveMapping('${item.original_status}', 'ì·¨ì†Œ')">
                                <i class="bi bi-x-circle"></i> ì·¨ì†Œ
                            </button>
                            <button class="btn btn-outline-danger" onclick="saveMapping('${item.original_status}', 'ë°˜í’ˆ')">
                                <i class="bi bi-arrow-return-left"></i> ë°˜í’ˆ
                            </button>
                            <button class="btn btn-outline-info" onclick="saveMapping('${item.original_status}', 'êµí™˜')">
                                <i class="bi bi-arrow-repeat"></i> êµí™˜
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            document.getElementById('unmappedStatusList').innerHTML = html;
            
        } catch (error) {
            document.getElementById('unmappedStatusList').innerHTML = `
                <div class="alert alert-danger">
                    <i class="bi bi-exclamation-triangle"></i> ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.
                </div>
            `;
        }
    }

    // ===== ë§¤í•‘ ì €ì¥ =====
    async function saveMapping(originalStatus, normalizedStatus) {
        try {
            const formData = new FormData();
            formData.append('original_status', originalStatus);
            formData.append('normalized_status', normalizedStatus);
            
            const response = await fetch('/orders/api/save-status-mapping', {
                method: 'POST',
                body: formData
            });
            
            const result = await response.json();
            
            if (result.success) {
                alert(`"${originalStatus}" â†’ "${normalizedStatus}" ë§¤í•‘ ì™„ë£Œ!`);
                showUnmappedModal();
            }
        } catch (error) {
            alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }

    // ===== í˜ì´ì§€ ë¡œë“œ ì‹œ ë‚ ì§œ ì´ˆê¸°í™” =====
    document.addEventListener('DOMContentLoaded', function() {
        const today = new Date();
        const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
        
        const startInput = document.getElementById('statusStartDate');
        const endInput = document.getElementById('statusEndDate');
        
        if (startInput && endInput) {
            startInput.valueAsDate = firstDay;
            endInput.valueAsDate = today;
        }
    });

    // ===== í†µê´€ ì¡°íšŒ í•¨ìˆ˜ =====
    
    // ë¡œë”© í‘œì‹œ/ìˆ¨ê¹€
    function showCustomsLoading() {
        document.getElementById('loadingOverlay').style.display = 'flex';
    }

    function hideCustomsLoading() {
        document.getElementById('loadingOverlay').style.display = 'none';
    }

    // ì£¼ë¬¸ IDë¡œ í†µê´€ ì¡°íšŒ
    async function viewCustoms(orderId) {
        try {
            console.log('=== í†µê´€ ì¡°íšŒ ì‹œì‘ ===');
            console.log('Order ID:', orderId);
            
            showCustomsLoading();
            
            const response = await fetch(`/orders/api/customs/${orderId}`);
            const data = await response.json();
            
            console.log('í†µê´€ ì¡°íšŒ ì‘ë‹µ:', data);
            
            hideCustomsLoading();
            
            if (data.success) {
                displayCustomsModal(data);
            } else {
                alert(data.message || 'í†µê´€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
            
        } catch (error) {
            console.error('í†µê´€ ì¡°íšŒ ì˜¤ë¥˜:', error);
            hideCustomsLoading();
            alert('í†µê´€ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }

    // ì†¡ì¥ë²ˆí˜¸/B/Lë¡œ ì§ì ‘ ì¡°íšŒ
    async function searchCustoms(event) {
        event.preventDefault();
        
        const trackingNumber = document.getElementById('trackingNumberInput').value.trim();
        const masterBl = document.getElementById('masterBlInput').value.trim();
        const houseBl = document.getElementById('houseBlInput').value.trim();
        
        if (!trackingNumber && !masterBl) {
            alert('ì†¡ì¥ë²ˆí˜¸ ë˜ëŠ” ë§ˆìŠ¤í„° B/Lì„ ì…ë ¥í•˜ì„¸ìš”.');
            return;
        }
        
        try {
            showCustomsLoading();
            
            let url = '';
            let params = new URLSearchParams();
            
            if (trackingNumber) {
                url = '/orders/api/customs/search/tracking';
                params.append('tracking_number', trackingNumber);
            } else if (masterBl) {
                url = '/orders/api/customs/search';
                params.append('master_bl', masterBl);
                if (houseBl) {
                    params.append('house_bl', houseBl);
                }
            }
            
            const response = await fetch(`${url}?${params.toString()}`);
            const data = await response.json();
            
            console.log('í†µê´€ ì¡°íšŒ ì‘ë‹µ:', data);
            
            hideCustomsLoading();
            
            if (data.success) {
                displayCustomsModal(data);
                document.getElementById('customsSearchForm').reset();
            } else {
                alert(data.message || 'í†µê´€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
            
        } catch (error) {
            console.error('í†µê´€ ì¡°íšŒ ì˜¤ë¥˜:', error);
            hideCustomsLoading();
            alert('í†µê´€ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }

    // í†µê´€ ì •ë³´ ëª¨ë‹¬ í‘œì‹œ (7customs ë²„ì „)
    function displayCustomsModal(data) {
        const modal = new bootstrap.Modal(document.getElementById('customsModal'));
        const content = document.getElementById('customsContent');
        
        const basicInfo = data.basic_info || {};
        const history = data.history || [];
        
        const cleanedTracking = cleanTrackingNumber(data.tracking_number);

        let html = `
            <div class="customs-info">
                <!-- ì¡°íšŒ ì •ë³´ í—¤ë” -->
                <div class="alert alert-info mb-4">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h5 class="mb-0">
                                <i class="bi bi-upc-scan"></i> 
                                <strong>ì†¡ì¥ë²ˆí˜¸:</strong> ${cleanedTracking}
                            </h5>
                        </div>
                        <div class="col-md-4 text-end">
                            ${data.url ? `
                                <a href="${data.url}" target="_blank" class="btn btn-sm btn-outline-primary">
                                    <i class="bi bi-box-arrow-up-right"></i> 7customs.comì—ì„œ ë³´ê¸°
                                </a>
                            ` : ''}
                        </div>
                    </div>
                </div>
                
                <!-- í†µê´€ ìƒíƒœ ì¹´ë“œ -->
                <div class="card mb-4" style="border-left: 4px solid #667eea;">
                    <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                        <h5 class="mb-0"><i class="bi bi-clipboard-check"></i> í†µê´€ ìƒíƒœ</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="text-muted small d-block">í˜„ì¬ ìƒíƒœ</label>
                                <h4 class="mb-0" style="color: #667eea;">
                                    ${basicInfo.customs_status || 'ì •ë³´ ì—†ìŒ'}
                                </h4>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="text-muted small d-block">í†µê´€ì™„ë£Œ ì˜ˆìƒì¼</label>
                                <h5 class="mb-0 text-danger">
                                    ${basicInfo.expected_clearance_date || 'ì •ë³´ ì—†ìŒ'}
                                </h5>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="text-muted small d-block">ì…í•­ì¼</label>
                                <p class="mb-0 h6">
                                    ${basicInfo.arrival_date || 'ì •ë³´ ì—†ìŒ'}
                                </p>
                            </div>
                        </div>
                        <hr>
                        <div>
                            <label class="text-muted small d-block">ë¬¼í’ˆì •ë³´</label>
                            <p class="mb-0">
                                ${basicInfo.product_info || 'ì •ë³´ ì—†ìŒ'}
                            </p>
                        </div>
                    </div>
                </div>
        `;
        
        // í†µê´€ìƒì„¸ë‚´ì—­ (íˆìŠ¤í† ë¦¬)
        if (history && history.length > 0) {
            html += `
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h6 class="mb-0">
                            <i class="bi bi-clock-history"></i> í†µê´€ìƒì„¸ë‚´ì—­ (${history.length}ê±´)
                        </h6>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th width="15%">ì²˜ë¦¬êµ¬ë¶„</th>
                                        <th width="50%">ë‚´ìš©</th>
                                        <th width="20%">ì²˜ë¦¬ì¼ì‹œ</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            history.forEach(item => {
                html += `
                                    <tr>
                                        <td>
                                            <span class="badge bg-primary" style="font-size: 0.85rem;">
                                                ${item.process_type || '-'}
                                            </span>
                                        </td>
                                        <td>${item.content || '-'}</td>
                                        <td>
                                            <small class="text-muted">
                                                ${item.processing_datetime || '-'}
                                            </small>
                                        </td>
                                    </tr>
                `;
            });
            
            html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        } else {
            html += `
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle-fill"></i> 
                    í†µê´€ ì§„í–‰ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.
                </div>
            `;
        }
        
        html += `</div>`;
        
        content.innerHTML = html;
        modal.show();
    }
</script>

{% endblock %}